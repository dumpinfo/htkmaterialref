<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3.0//EN">
<!--Converted with LaTeX2HTML 96.1 (Feb 5, 1996) by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds -->
<HTML>
<HEAD>
<TITLE>9.4 Data-Driven Clustering</TITLE>
<META NAME="description" CONTENT="9.4 Data-Driven Clustering">
<META NAME="keywords" CONTENT="HTKBook">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<LINK REL=STYLESHEET HREF="HTKBook.css">
</HEAD>
<BODY LANG="EN">
 <A NAME="tex2html3110" HREF="node120.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html3108" HREF="node115.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html3102" HREF="node118.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html3112" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A> <A NAME="tex2html3113" HREF="node263.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html3111" HREF="node120.html">9.5 Tree-Based Clustering</A>
<B>Up:</B> <A NAME="tex2html3109" HREF="node115.html">9 HMM System Refinement</A>
<B> Previous:</B> <A NAME="tex2html3103" HREF="node118.html">9.3 Parameter Tying and Item Lists</A>
<BR> <P>
<H1><A NAME="SECTION03640000000000000000">9.4 Data-Driven Clustering</A></H1>
<A NAME="sddclust">&#160;</A>
<P>
In
section&nbsp;<A HREF="node117.html#smkCDHMMs">9.2</A>, a method of triphone construction was described
which involved cloning all monophones and then re-estimating them using data
for which monophone labels have been replaced by triphone labels.  
This will lead to a very large set of models, and relatively little
training data for each model.  Applying the argument that context will not greatly affect
the centre states of triphone models, one way to reduce the 
total number of parameters without 
significantly altering the models' ability to represent the different
contextual effects might be to tie all of the centre states across all
models derived from the same monophone.  This tying could 
be<A NAME=9762>&#160;</A>
done by writing an edit script of the form
<PRE>     TI &quot;iyS3&quot; {*-iy+*.state[3]}
     TI &quot;ihS3&quot; {*-ih+*.state[3]}
     TI &quot;ehS3&quot; {*-eh+*.state[3]}
      .... etc</PRE>
Each <tt>TI</tt> command would tie all the centre states of all triphones
in each phone group. Hence, if there were an average of 100 triphones
per phone group then the total number of states per group
would be reduced from
300 to 201.
<P>
Explicit tyings such as these can have some positive effect but overall they 
are not very satisfactory.  Tying all centre states is too severe and worse
still, the problem of undertraining for the left and right states remains.
A much better approach is to use clustering to decide which states to
tie.  HHED provides two mechanisms for this.  In this section
a data-driven clustering approach will be described and in
the next section, an alternative decision tree-based approach is presented.
<P>
Data-driven clustering is performed by the <A NAME=9765>&#160;</A>
<tt>TC</tt><A NAME=9928>&#160;</A> and 
<tt>NC</tt><A NAME=9929>&#160;</A>
commands.  These both invoke the same top-down hierarchical
procedure.  Initially all states are placed in individual
clusters.  The pair of clusters which when combined would form the smallest
resultant cluster are merged.  This process repeats until either the
size of the largest
cluster reaches the threshold set by the <tt>TC</tt> command or
the total number of clusters has fallen to that
specified by by the <tt>NC</tt> command.  The size of cluster
is defined as the greatest distance between any two states.
The distance metric depends on the type of state distribution.
For single Gaussians, a weighted Euclidean distance between the means
is used and for tied-mixture systems a  Euclidean distance between the
mixture weights is used.  For all other cases, the average probability
of each component mean with respect to the other state is used.
The details of the algorithm and these metrics are given in the reference
section for HHED.
<P>
<A NAME="ftiedstate">&#160;</A> <IMG WIDTH=413 HEIGHT=383 ALIGN=BOTTOM ALT="tex2html_wrap21978" SRC="img438.gif"  > 
<P>
As an example, the following HHED script would cluster and tie the
corresponding states of the triphone group for the phone <tt>ih</tt>
<PRE>     TC 100.0 &quot;ihS2&quot; {*-ih+*.state[2]}
     TC 100.0 &quot;ihS3&quot; {*-ih+*.state[3]}
     TC 100.0 &quot;ihS4&quot; {*-ih+*.state[4]}</PRE>
In this example, each <tt>TC</tt> command performs clustering on the specified
set of states, each cluster is  tied and output as a macro.  The macro name
is generated by appending the cluster index to
the macro  name given in the command.   The effect of this command 
is illustrated in Fig.&nbsp;<A HREF="node119.html#ftiedstate">9.2</A>.  Note that if a word-internal
triphone system is being built, it is sensible to include biphones as well
as triphones in the item list, for example, the first command above would
be written as
<PRE>     TC 100.0 &quot;ihS2&quot; {(*-ih,ih+*,*-ih+*).state[2]}</PRE>
If the above <tt>TC</tt> commands are repeated for all phones, the resulting  set of
tied-state models will have far
fewer parameters in total than the original untied set.  The numeric argument
immediately following the <tt>TC</tt> command name is the cluster threshold.  Increasing
this value will allow larger and hence, fewer clusters. The aim, of
course, is to strike the right balance between compactness and the acoustic
accuracy of the individual models.  In practice, the use of this command
requires some experimentation to find a good threshold value. HHED provides
extensive trace  output for monitoring clustering operations.  Note in this
respect that as well as setting tracing from the command line and the
configuration file, tracing in HHED can be set by the <tt>TR</tt> command. 
Thus,  tracing can be controlled at the command level. Further trace
information can be obtained by including the <tt>SH</tt> command<A NAME=9930>&#160;</A> at strategic
points in the edit script.  The effect of executing this command is to list
out all of the parameter tyings currently in force.
<P>
A potential problem with the use of the <tt>TC</tt> and <tt>NC</tt> commands is
that <I>outlier</I> states will tend to form their own singleton 
clusters<A NAME=9790>&#160;</A> for
which there is then insufficient data to properly train.  One solution to
this is to use the <tt>RO</tt> command<A NAME=9931>&#160;</A> to 
remove outliers<A NAME=9793>&#160;</A>.  This commmand has
the form
<PRE>     RO thresh &quot;statsfile&quot;</PRE>
where <tt>statsfile</tt> is the name of a statistics file<A NAME=9795>&#160;</A> output using the
<tt>-s</tt> option of HEREST.  This statistics file holds the 
<EM>occupation counts</EM> for all states of the HMM set being trained.  
The term <EM>occupation count</EM> refers to the number of frames allocated to a
particular state and can be used as a measure of how much training data is
available for estimating the parameters of that state.  
The <tt>RO</tt> command must be executed <I>before</I> the <tt>TC</tt> or
<tt>NC</tt> commands used to do the actual clustering. Its effect is to simply
read in the statistics information from the given file and then to set a flag
instructing the
<tt>TC</tt> or <tt>NC</tt> commands to remove any outliers remaining at 
the conclusion
of the normal clustering process.  This is done by repeatedly finding the
cluster with the smallest total occupation count and merging it with its
nearest neighbour. This process is repeated until all clusters have a total
occupation count which exceeds <tt>thresh</tt>, thereby ensuring that every
cluster of states will be properly trained in the subsequent re-estimation
performed by HEREST.<A NAME=9808>&#160;</A>
<P>
On completion of the above clustering and tying procedures, many of the models
may be effectively identical, since acoustically similar triphones may share
common clusters for all their emitting states.  They are then, in effect,
so-called <I>generalised triphones</I>.<A NAME=9810>&#160;</A> State tying
can be further exploited if the HMMs which are effectively equivalent are
identified and then tied via the physical-logical mapping<A NAME="tex2html731" HREF="footnode.html#9811"><IMG  ALIGN=BOTTOM ALT="gif" SRC="foot_motif.gif"></A> facility provided by HMM lists (see section&nbsp;<A HREF="node97.html#shmmsets">7.4</A>). The
effect of this would be to reduce the total number of HMM definitions required.
HHED provides a compaction command to do all of this automatically.
For example, the command
<PRE>     CO newList</PRE>
<A NAME=9932>&#160;</A>will compact<A NAME=9815>&#160;</A> 
the currently loaded HMM set by identifying equivalent models
and then tying them via the new HMM list output  to the 
file <tt>newList</tt>.  Note, however, that for two HMMs to be tied, they
must be identical in all respects.
This is one of the reasons why transition parameters are often tied
across triphone groups otherwise HMMs with identical states would still
be left distinct due to minor differences in their transition matrices.
<P>
<HR><A NAME="tex2html3110" HREF="node120.html"><IMG WIDTH=37 HEIGHT=24 ALIGN=BOTTOM ALT="next" SRC="next_motif.gif"></A> <A NAME="tex2html3108" HREF="node115.html"><IMG WIDTH=26 HEIGHT=24 ALIGN=BOTTOM ALT="up" SRC="up_motif.gif"></A> <A NAME="tex2html3102" HREF="node118.html"><IMG WIDTH=63 HEIGHT=24 ALIGN=BOTTOM ALT="previous" SRC="previous_motif.gif"></A> <A NAME="tex2html3112" HREF="node1.html"><IMG WIDTH=65 HEIGHT=24 ALIGN=BOTTOM ALT="contents" SRC="contents_motif.gif"></A> <A NAME="tex2html3113" HREF="node263.html"><IMG WIDTH=43 HEIGHT=24 ALIGN=BOTTOM ALT="index" SRC="index_motif.gif"></A> <BR>
<B> Next:</B> <A NAME="tex2html3111" HREF="node120.html">9.5 Tree-Based Clustering</A>
<B>Up:</B> <A NAME="tex2html3109" HREF="node115.html">9 HMM System Refinement</A>
<B> Previous:</B> <A NAME="tex2html3103" HREF="node118.html">9.3 Parameter Tying and Item Lists</A>
<P><ADDRESS>
ECRL HTK_V2.1: email support@entropic.com
</ADDRESS>
</BODY>
</HTML>
